{% extends 'kukan/base_ext.html' %}
{% load widget_tweaks %}

{% block title %}
例文の訂正
{% endblock %}

{% block javascript %}
<script>

    function get_yomi(word) {
        console.log(word);
        console.log("YOYO");
        $.ajax({
            url: '/kukan/ajax/get_yomi/',
            data: {
                'word': word
            },
            dataType: 'json',

            success: function(data) {
                console.log(data);
                idx = 0;
                $.each(data, function(name, value) {
                    console.log(name + '-' + value + idx);

                    $('#id_select_kanji_' + idx).html(name)
                    $('#id_select_label_' + idx).text(name)
                    $('#id_select_' + idx).prop('disabled', value['joyo']);
                    $('#id_select_' + idx).children('option:not(:first)').remove();

                    $.each(value['readings'], function(i, item) {
                        $('#id_select_' + idx).append($('<option>', {
                            value: item,
                            text: item
                        }));
                        if(value['selected']!=null) {
                            $('#id_select_' + idx).val(value['selected']).trigger('change');
                        } else {
                            $('#id_select_' + idx).val("未設定");
                        }
                        $('#id_select_column_' + idx).show();
                    });
                    idx += 1;
                });
                for (i = idx; i < 10; i++) {
                    $('#id_select_column_' + idx).hide();
                }
            }
        });
    };

    function set_yomi() {
        console.log('set yomi');
        $.ajax({
            url: '/kukan/ajax/set_yomi/',
            data: {
                'word': $('#id_word').val(),
                'yomi': $('#id_yomi').val()
            },
            dataType: 'json',

            success: function(data) {
                console.log(data);
            }
        });
    };

    function get_goo(word) {
        $.ajax({
            url: '/kukan/ajax/get_goo/',
            data: {
                'word': $('#id_word').val()
            },
            dataType: 'json',

            success: function(data) {
                console.log(data);
                $('#id_definition').text(data['meaning'])
                $('#get_goo').removeClass('is-loading');
            }
        });
    };

    $('#id_word').change(function() {
        get_yomi($(this).val());
    });

    $('#get_goo').click(function() {
        $(this).addClass('is-loading');
        get_goo();
    });

    $('#id_set_yomi').click(function() {
        set_yomi();
    });

    $(document).ready(function() {
            console.log("Ready");
        get_yomi($('#id_word').val());
    });

</script>
{% endblock %}


{% block content %}
    <section class="hero is-link is-hidden-mobile">
      <div class="hero-body">
        <div class="container">
          <h2 class="title">
            例文の訂正
          </h2>
        </div>
      </div>
    </section>

    <section class="hero is-link is-hidden-tablet">
      <div class="hero-body">
        <div class="container">
          <h2 class="subtitle">
            例文の訂正
          </h2>
        </div>
      </div>
    </section>

<section class="section">
<form action="." method="post">
{% csrf_token %}

    <div class="columns">
        <div class="column">
            <div class="field">
                <label class="label">単語</label>
                <div class="control">
                    {{ form.word|add_class:"input"|attr:"placeholder:単語（漢字・仮名）" }}
                </div>
            </div>
        </div>
        <div class="column">
            <label class="label">読み方</label>
            <div class="field has-addons">
                <p class="control is-expanded">
                    {{ form.yomi|add_class:"input"|attr:"placeholder:読み方（カタカナ）" }}
                </p>
                <p class="control" id="id_set_yomi">
                    <a class="button is-primary">
                    設定
                    </a>
            </div>
        </div>
    </div>


    <div class="columns is-multiline">
            {% for i in "xxxxxxxxxx" %}
                <div class="column" style="display:none" id="id_select_column_{{ forloop.counter0 }}">
                    <div class="columns is-mobile">
                        <div class="column is-narrow">
                            <p class="is-size-1" id="id_select_kanji_{{ forloop.counter0 }}">{{ kanji }}</p>
                        </div>
                        <div class="column">
                            <div class="field">
                                <label class="label help" id="id_select_label_{{ forloop.counter0 }}"></label>
                                <div class="control is-expanded">
                                    <div class="select is-fullwidth">
                                        <select name="yomi_{{ forloop.counter0 }}" id="id_select_{{ forloop.counter0 }}">
                                        <option value="未設定" disabled selected>未設定</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>

    <div class="field">
      <label class="label">例文</label>
      <div class="control">
          {{ form.sentence|add_class:"input"|attr:"placeholder:単語を含む例文を入力ください。" }}
      </div>
    </div>


    <div class="field">
        <div class="control has-addons">
            <label class="label">単語の意味 <a class="button is-small is-primary"  id="get_goo">習得</a></label>
        </div>
        <div class="control">
            {{ form.definition|add_class:"textarea"|attr:"placeholder:単語の意味・説明の文章を入力ください。" }}
        </div>
    </div>


    <div class="field is-grouped">
      <div class="control">
        <input type="submit" class="button is-link" value="保存" />
      </div>
      <div class="control">
        <button class="button is-text">取り消し</button>
      </div>
    </div>
  </div>


</form>

</section>
{% endblock %}

