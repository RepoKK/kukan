{% extends 'kukan/base.html' %}
{% block body %}
    {% block banner %}{% endblock %}
    <section class="section" style="padding-top: 1rem;padding-bottom: 1rem">
        <main>
            <div class="container" v-bind:class="containerSize">
                {% block content %}

                <nav class="level is-mobile">
                    <!-- Left side -->
                    <div class="level-left">
                        <div class="level-item">
                            <div class="column is-3">
                                <p>先発</p>
                                <p><span class="title is-4"
                                         id="next_time">--:--</span></p>
                            </div>
                        </div>
                    </div>

                    <!-- Right side -->
                    <div class="level-right">
                        <p class="level-item"><strong>後</strong></p>
                        <p><span class="title is-1" id="next_after">--:--</span>
                        </p>
                    </div>
                </nav>

                <nav class="level is-mobile">
                    <!-- Left side -->
                    <div class="level-left">
                        <div class="level-item">
                            <div class="column is-3">
                                <p>次発</p>
                                <p><span class="title is-4" id="next_next_time">--:--</span>
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Right side -->
                    <div class="level-right">
                        <p class="level-item"><strong>後</strong></p>
                        <p><span class="title is-3"
                                 id="next_next_after">--:--</span></p>
                    </div>
                </nav>

                <ul>
                {% for bus_time in list_times %}
                    <li>{{bus_time|time}}</li>
                {% endfor %}
                </ul>
                {% endblock %}
            </div>
        </main>
    </section>
{% endblock body%}

{% block mixin_ext %}
    var mixin_ext = {
        data: function () {
            return {
                showNavBar: true,
            }
        },
    }
{% endblock %}

{% block script %}
    {% block extra_script %}
<script>
const jstimes = [
{% for bus_time in list_times %}
  {{ bus_time|date:"U" }}000,
{% endfor %}
]

function msToTime(s) {
  let ms = s % 1000;
  s = (s - ms) / 1000;
  let secs = s % 60;
  s = (s - secs) / 60;
  let mins = s % 60;
  let hrs = (s - mins) / 60;

  if (hrs > 0) {
    return hrs + ':' + mins + ':' + secs;
  } else {
    if (secs > 9 ) {
        return mins + ':' + secs;
    } else {
        return mins + ':' + '0' + secs;
    }
  }
}

function myFunction() {
    now = Date.now()
    let next_time = new Date(jstimes.find(o => o > now));
    let time_to_next = (next_time - now);
    document.getElementById("next_after").innerHTML = msToTime(time_to_next)
    document.getElementById("next_time").innerHTML = next_time.toTimeString().substr(0, 5);

    let next_next_time = new Date(jstimes.find(o => o > next_time));
    time_to_next = (next_next_time - now);
    document.getElementById("next_next_after").innerHTML = msToTime(time_to_next)
    document.getElementById("next_next_time").innerHTML = next_next_time.toTimeString().substr(0, 5);
}

myFunction()
setInterval(myFunction, 1000)
console.log(jstimes[0])
</script>

{% endblock %}
    {% block vue_component %}{% endblock %}
{% endblock script%}

